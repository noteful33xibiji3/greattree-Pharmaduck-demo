<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pharma.Duck æ™ºæ…§è—¥å¸«åŠ©ç† (æ±ºè³½æ¼”ç¤ºç‰ˆ)</title>
    <style>
        /* === 1. åŸºç¤è¨­å®š === */
        :root { --gt-green: #009944; --gt-orange: #F39800; --bg-gray: #f5f5f5; --gold: #FFD700; }
        body { font-family: "Microsoft JhengHei", sans-serif; background-color: var(--bg-gray); margin: 0; padding-bottom: 80px; }
        button { cursor: pointer; }

        /* Header */
        header { background: white; padding: 15px 0; border-bottom: 4px solid var(--gt-green); position: sticky; top: 0; z-index: 1000; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .nav-container { max-width: 1200px; margin: 0 auto; display: flex; align-items: center; justify-content: space-between; padding: 0 20px; }
        .logo img { height: 45px; } 
        
        /* å°èˆªæŒ‰éˆ• */
        .nav-btn { padding: 8px 15px; border-radius: 20px; border: 2px solid transparent; font-weight: bold; color: #555; transition: 0.3s; }
        .nav-btn:hover { background: #f0fdf4; color: var(--gt-green); }
        .nav-btn.active { background: var(--gt-green); color: white; }
        .coin-display { display: flex; align-items: center; gap: 5px; background: #fffbe6; padding: 5px 12px; border-radius: 15px; border: 1px solid var(--gold); font-size: 14px; font-weight: bold; color: #b7791f; }

        /* === 2. é é¢åˆ‡æ›æ§åˆ¶ === */
        .page-section { display: none; animation: fadeIn 0.5s; } /* é è¨­éš±è— */
        .page-section.active { display: block; } /* é¡¯ç¤ºå•Ÿç”¨çš„é é¢ */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* === 3. è³¼ç‰©èˆ‡å°è³¼é¦–é æ¨£å¼ (Shop View) === */
        .main-content { max-width: 1200px; margin: 30px auto; padding: 0 20px; }
        .product-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 20px; }
        .product-card { background: white; padding: 15px; border-radius: 12px; position: relative; border: 2px solid transparent; transition: 0.2s; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
        .product-card:hover { border-color: var(--gt-green); transform: translateY(-5px); }
        .tag { position: absolute; top: 10px; right: 10px; color: white; padding: 4px 10px; font-size: 12px; border-radius: 20px; font-weight: bold; }
        .p-img { width: 100%; height: 160px; object-fit: contain; margin-bottom: 15px; }

        /* === 4. é´¨é´¨é¤Šæˆä¸­å¿ƒæ¨£å¼ (Game View) === */
        .game-container { max-width: 1000px; margin: 30px auto; padding: 0 20px; }
        
        /* å„€è¡¨æ¿ */
        .dashboard-header { background: linear-gradient(135deg, #009944, #00662d); color: white; border-radius: 20px; padding: 30px; display: flex; align-items: center; justify-content: space-between; box-shadow: 0 10px 20px rgba(0,153,68,0.2); position: relative; overflow: hidden; }
        .dashboard-header::after { content: "SEASON 1"; position: absolute; top: 10px; right: 10px; background: rgba(255,255,255,0.2); padding: 5px 10px; border-radius: 10px; font-size: 12px; font-weight: bold; }
        
        .duck-status { display: flex; align-items: center; gap: 30px; position: relative; z-index: 2; }
        .duck-avatar-large { width: 150px; height: 150px; background: white; border-radius: 50%; border: 5px solid var(--gold); object-fit: cover; box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
        
        .level-info h1 { margin: 0; font-size: 32px; text-shadow: 0 2px 4px rgba(0,0,0,0.2); }
        .level-info p { margin: 5px 0 15px 0; opacity: 0.9; }
        
        /* ç¶“é©—æ¢ */
        .exp-bar-container { width: 300px; background: rgba(0,0,0,0.3); height: 12px; border-radius: 6px; overflow: hidden; position: relative; }
        .exp-bar-fill { height: 100%; background: var(--gold); width: 20%; transition: width 0.5s ease; }
        .exp-text { position: absolute; top: -20px; right: 0; font-size: 12px; font-weight: bold; }

        /* ä»»å‹™å€èˆ‡å•†åŸå€ */
        .game-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-top: 30px; }
        .panel { background: white; border-radius: 20px; padding: 25px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
        .panel h2 { border-left: 5px solid var(--gt-orange); padding-left: 15px; margin-top: 0; color: #333; }

        .task-item { display: flex; justify-content: space-between; align-items: center; padding: 15px; border-bottom: 1px solid #eee; transition: 0.2s; }
        .task-item:hover { background: #fafafa; }
        .task-desc { display: flex; flex-direction: column; }
        .task-reward { color: var(--gt-green); font-weight: bold; font-size: 13px; }
        .btn-claim { background: var(--gt-green); color: white; border: none; padding: 8px 15px; border-radius: 20px; font-size: 12px; }
        .btn-claim:disabled { background: #ccc; cursor: not-allowed; }

        /* å•†åŸå¡ç‰‡ */
        .shop-items { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; }
        .shop-card { border: 1px solid #eee; border-radius: 10px; padding: 10px; text-align: center; position: relative; }
        .shop-card.limited::before { content: "é™æ™‚"; position: absolute; top: 5px; left: 5px; background: #d0021b; color: white; font-size: 10px; padding: 2px 5px; border-radius: 4px; }
        .shop-img { width: 80px; height: 80px; object-fit: contain; margin: 0 auto; }
        .price-tag { color: #b7791f; font-weight: bold; margin: 5px 0; }
        .btn-buy { width: 100%; background: var(--gt-orange); color: white; border: none; padding: 5px; border-radius: 5px; }

        /* === 5. èŠå¤©è¦–çª— (Chat) === */
        .duck-fab { position: fixed; bottom: 20px; right: 20px; width: 140px; cursor: pointer; z-index: 2000; transition: transform 0.3s; }
        .duck-fab:hover { transform: scale(1.05); }
        .chat-window { position: fixed; bottom: 20px; right: 180px; width: 350px; height: 550px; background: white; border-radius: 20px; box-shadow: 0 10px 40px rgba(0,0,0,0.3); display: none; flex-direction: column; overflow: hidden; z-index: 2001; border: 1px solid #ddd; }
        .chat-header { background: var(--gt-green); color: white; padding: 15px; display: flex; align-items: center; justify-content: space-between; }
        .chat-body { flex: 1; padding: 20px; overflow-y: auto; background: #f0fdf4; }
        .msg { margin-bottom: 15px; clear: both; }
        .msg-duck .bubble { background: white; padding: 12px; border-radius: 15px; border: 1px solid #eee; float: left; max-width: 80%; }
        .msg-user .bubble { background: var(--gt-green); color: white; padding: 12px; border-radius: 15px; float: right; max-width: 80%; }
        .chat-input { padding: 15px; border-top: 1px solid #eee; display: flex; gap: 10px; background: white; }
        .chat-input input { flex: 1; padding: 10px; border-radius: 20px; border: 1px solid #ddd; outline: none; }
        
        /* å‡ç´šå½ˆçª— */
        .level-up-modal { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(0,0,0,0.9); color: #FFD700; padding: 30px; border-radius: 20px; text-align: center; display: none; z-index: 3000; border: 2px solid #FFD700; width: 250px; }
    </style>
</head>
<body>

<header>
    <div class="nav-container">
        <div class="logo">
            <img src="images/logo.png" alt="å¤§æ¨¹è—¥å±€" onerror="this.parentNode.innerText='ğŸŒ³ å¤§æ¨¹å¥åº·è³¼ç‰©ç¶² (Demo)'">
        </div>
        
        <div style="display: flex; gap: 10px; align-items: center;">
            <button class="nav-btn active" onclick="switchPage('shop')" id="btn-shop">ğŸ  è³¼ç‰©é¦–é </button>
            <button class="nav-btn" onclick="switchPage('game')" id="btn-game">ğŸ¦† æˆ‘çš„é´¨é´¨ (æœƒå“¡)</button>
            
            <div class="coin-display">
                <span>ğŸ’°</span>
                <span id="headerCoins">0</span>
            </div>
        </div>
    </div>
</header>

<div id="page-shop" class="page-section active">
    <div class="main-content">
        <div style="font-size: 24px; font-weight: bold; border-left: 5px solid var(--gt-orange); padding-left: 15px; margin-bottom: 20px;">
            æœ¬å­£ç†±éŠ·ï¼šå¥åº·ä¿å¥å°ˆå€
        </div>
        <div class="product-grid" id="productGrid">
            </div>
    </div>
</div>

<div id="page-game" class="page-section">
    <div class="game-container">
        <div class="dashboard-header">
            <div class="duck-status">
                <img src="images/my_duck.png" class="duck-avatar-large" id="gameDuckImg" onerror="this.src='https://placehold.co/200x200/F39800/white?text=Duck'">
                <div class="level-info">
                    <h1 id="levelDisplay">Lv.1 è›‹æ®¼é´¨</h1>
                    <p>ä¸‹ä¸€å­£æ­¸é›¶ï¼šé‚„æœ‰ 120 å¤©</p>
                    <div style="display:flex; gap:10px;">
                        <span style="background:rgba(0,0,0,0.2); padding:2px 8px; border-radius:5px; font-size:12px;">è³¼ç‰©å„ªæƒ  1% OFF</span>
                    </div>
                </div>
            </div>
            
            <div style="text-align: right;">
                <div style="font-size: 14px; margin-bottom: 5px;">æœ¬å­£ç¶“é©—å€¼ (EXP)</div>
                <div class="exp-bar-container">
                    <div class="exp-bar-fill" id="expBar" style="width: 0%;"></div>
                    <div class="exp-text" id="expText">0 / 100</div>
                </div>
                <div style="margin-top: 15px; font-size: 14px;">ç›®å‰æŒæœ‰å¤§æ¨¹å¹£</div>
                <div style="font-size: 28px; font-weight: bold; color: #fff;">ğŸ’° <span id="gameCoins">0</span></div>
            </div>
        </div>

        <div class="game-grid">
            <div class="panel">
                <h2>ğŸ“ æ¯æ—¥å¥åº·ä»»å‹™</h2>
                <div id="taskList">
                    <div class="task-item">
                        <div class="task-desc">
                            <span>æ¯æ—¥ç™»å…¥ç°½åˆ°</span>
                            <span class="task-reward">+10 EXP | +5 å¹£</span>
                        </div>
                        <button class="btn-claim" onclick="completeTask(this, 10, 5)">é ˜å–</button>
                    </div>
                    <div class="task-item">
                        <div class="task-desc">
                            <span>å¡«å¯«å¥åº·å•å·</span>
                            <span class="task-reward">+50 EXP | +20 å¹£</span>
                        </div>
                        <button class="btn-claim" onclick="completeTask(this, 50, 20)">å‰å¾€</button>
                    </div>
                    <div class="task-item">
                        <div class="task-desc">
                            <span>æŸ¥çœ‹é™„è¿‘é–€å¸‚åœ°åœ–</span>
                            <span class="task-reward">+30 EXP | +10 å¹£</span>
                        </div>
                        <button class="btn-claim" onclick="completeTask(this, 30, 10)">æŸ¥çœ‹</button>
                    </div>
                </div>
            </div>

            <div class="panel">
                <h2>ğŸ‘• é´¨é´¨æ™‚è£ & å…Œæ›</h2>
                <div class="shop-items">
                    <div class="shop-card limited">
                        <img src="images/item_hat.jpg" class="shop-img" onerror="this.src='https://placehold.co/100x100/333/fff?text=Dr.Hat'">
                        <div style="font-size:14px; font-weight:bold;">åšå£«é´¨å¥—è£</div>
                        <div class="price-tag">50 å¹£</div>
                        <button class="btn-buy" onclick="buyItem(50, 'åšå£«é´¨å¥—è£')">å…Œæ›</button>
                    </div>
                    <div class="shop-card">
                        <img src="images/item_coupon.jpg" class="shop-img" onerror="this.src='https://placehold.co/100x100/d0021b/fff?text=$50'">
                        <div style="font-size:14px; font-weight:bold;">$50 è³¼ç‰©é‡‘</div>
                        <div class="price-tag">100 å¹£</div>
                        <button class="btn-buy" onclick="buyItem(100, '$50 è³¼ç‰©é‡‘')">å…Œæ›</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="duck-fab" onclick="toggleChat()" id="chatFab">
    <img src="images/my_duck.png" alt="Chat" onerror="this.src='https://placehold.co/150x150/F39800/white?text=Duck'">
</div>

<div class="chat-window" id="chatWindow">
    <div class="chat-header">
        <span>Ph.D é´¨å­è—¥å¸«</span>
        <span style="cursor:pointer" onclick="toggleChat()">âœ•</span>
    </div>
    <div class="chat-body" id="chatBody">
        <div class="msg msg-duck"><div class="bubble">å‘±ï¼æˆ‘æ˜¯é´¨å­è—¥å¸«ã€‚è©¦è‘—è¼¸å…¥ã€Œé ­ç—›ã€é«”é©—æª¢å‚·ï¼Œå®Œæˆå¾Œå¯ä»¥ç²å¾—ç¶“é©—å€¼å–”ï¼ğŸ¦†</div></div>
    </div>
    <div class="chat-input">
        <input type="text" id="userInput" placeholder="è¼¸å…¥ç—‡ç‹€..." onkeypress="handleKey(event)">
        <button onclick="sendMessage()">â¤</button>
    </div>
</div>

<div class="level-up-modal" id="levelUpModal">
    <div style="font-size: 50px;">ğŸ‰</div>
    <h2>æ­å–œå‡ç´šï¼</h2>
    <p id="levelUpText">Lv.2 å¯¦ç¿’é´¨</p>
    <p style="font-size:12px; color:#ddd;">è§£é–æ–°å„ªæƒ èˆ‡æ™‚è£</p>
</div>

<script>
    // === éŠæˆ²æ•¸æ“šç‹€æ…‹ ===
    let gameState = {
        level: 1,
        exp: 0,
        maxExp: 100,
        coins: 0
    };

    const levels = [
        { lv: 1, name: "Lv.1 è›‹æ®¼é´¨", max: 100 },
        { lv: 2, name: "Lv.2 å¯¦ç¿’é´¨", max: 200 },
        { lv: 3, name: "Lv.3 è—¥å¸«é´¨", max: 300 },
        { lv: 4, name: "Lv.4 è³‡æ·±é´¨", max: 400 },
        { lv: 5, name: "Lv.5 åº—é•·é´¨", max: 500 },
        { lv: 10, name: "Lv.10 Ph.D åšå£«é´¨", max: 9999 }
    ];

    // === é é¢åˆ‡æ›é‚è¼¯ ===
    function switchPage(pageId) {
        // éš±è—æ‰€æœ‰é é¢
        document.querySelectorAll('.page-section').forEach(el => el.classList.remove('active'));
        document.querySelectorAll('.nav-btn').forEach(el => el.classList.remove('active'));

        // é¡¯ç¤ºç›®æ¨™é é¢
        document.getElementById(`page-${pageId}`).classList.add('active');
        document.getElementById(`btn-${pageId}`).classList.add('active');
        
        // å¦‚æœåœ¨éŠæˆ²é ï¼Œéš±è—æ‡¸æµ®é´¨å­ (é¿å…æ“‹ä½)
        const fab = document.getElementById('chatFab');
        fab.style.display = (pageId === 'game') ? 'none' : 'block';
    }

    // === ç¶“é©—å€¼èˆ‡é‡‘å¹£ç³»çµ± ===
    function gainReward(exp, coins) {
        // å¢åŠ æ•¸å€¼
        gameState.exp += exp;
        gameState.coins += coins;
        
        // æª¢æŸ¥å‡ç´š
        let currentLvConfig = levels.find(l => l.lv === gameState.level);
        if (gameState.exp >= currentLvConfig.max && gameState.level < 10) {
            gameState.exp -= currentLvConfig.max;
            gameState.level++;
            showLevelUp();
        }

        updateUI();
    }

    function updateUI() {
        // æ›´æ–°å¹£
        document.getElementById('headerCoins').innerText = gameState.coins;
        document.getElementById('gameCoins').innerText = gameState.coins;

        // æ›´æ–°ç­‰ç´šèˆ‡ç¶“é©—æ¢
        let currentConfig = levels.find(l => l.lv === gameState.level) || levels[levels.length-1];
        document.getElementById('levelDisplay').innerText = currentConfig.name;
        
        // è¨ˆç®—ç™¾åˆ†æ¯”
        let percent = Math.min(100, (gameState.exp / currentConfig.max) * 100);
        document.getElementById('expBar').style.width = `${percent}%`;
        document.getElementById('expText').innerText = `${gameState.exp} / ${currentConfig.max}`;
    }

    function showLevelUp() {
        const modal = document.getElementById('levelUpModal');
        let name = levels.find(l => l.lv === gameState.level).name;
        document.getElementById('levelUpText').innerText = name;
        modal.style.display = 'block';
        setTimeout(() => modal.style.display = 'none', 3000);
    }

    // === ä»»å‹™èˆ‡å•†åŸäº’å‹• ===
    function completeTask(btn, exp, coins) {
        btn.disabled = true;
        btn.innerText = "å·²å®Œæˆ";
        gainReward(exp, coins);
        alert(`å®Œæˆä»»å‹™ï¼ç²å¾— ${exp} ç¶“é©—å€¼ èˆ‡ ${coins} å¤§æ¨¹å¹£`);
    }

    function buyItem(cost, name) {
        if(gameState.coins >= cost) {
            gameState.coins -= cost;
            updateUI();
            alert(`è³¼è²·æˆåŠŸï¼æ‚¨å·²ç²å¾—ï¼š${name}`);
        } else {
            alert("å¤§æ¨¹å¹£ä¸è¶³ï¼å¿«å»å®Œæˆä»»å‹™æˆ–æ‰¾é´¨é´¨è«®è©¢å§ï¼");
        }
    }

    // === è³¼ç‰©ç¶²å•†å“ç”Ÿæˆ ===
    const products = [
        { name: "æ™®æ‹¿ç–¼ æ­¢ç—›éŒ ", price: 150, type: "drug", image: "images/p_panadol.jpg" },
        { name: "å¤§æ¨¹ Bç¾¤+éµ", price: 600, type: "food", image: "images/p_b_complex.jpg" },
        { name: "åˆåˆ©ä»–å‘½ Ex Plus", price: 1800, type: "drug", image: "images/p_explus.jpg" },
        { name: "èŠèƒç¾ ç¶œåˆç¶­ä»–å‘½", price: 850, type: "food", image: "images/p_multi_vit.jpg" }
    ];
    const grid = document.getElementById('productGrid');
    products.forEach(p => {
        grid.innerHTML += `
            <div class="product-card">
                <div class="tag" style="background:${p.type==='drug'?'#d0021b':'#009944'}">${p.type==='drug'?'è—¥å“':'é£Ÿå“'}</div>
                <img class="p-img" src="${p.image}" onerror="this.src='https://placehold.co/300x200/eee/333?text=${p.name}'">
                <div style="font-weight:bold">${p.name}</div>
                <div style="color:#d0021b; font-weight:bold">$${p.price}</div>
            </div>`;
    });

    // === èŠå¤©é‚è¼¯ (æ•´åˆç‰ˆ) ===
    let chatStep = 0;
    function toggleChat() {
        const win = document.getElementById('chatWindow');
        win.style.display = win.style.display === 'flex' ? 'none' : 'flex';
    }
    function handleKey(e) { if(e.key === 'Enter') sendMessage(); }
    
    function sendMessage() {
        const input = document.getElementById('userInput');
        const text = input.value.trim();
        if(!text) return;
        
        // é¡¯ç¤ºç”¨æˆ¶è¨Šæ¯
        const body = document.getElementById('chatBody');
        body.innerHTML += `<div class="msg msg-user"><div class="bubble">${text}</div></div>`;
        input.value = '';
        body.scrollTop = body.scrollHeight;

        setTimeout(() => {
            let reply = "é´¨é´¨æ­£åœ¨å­¸ç¿’ä¸­... è«‹è¼¸å…¥ã€Œé ­ç—›ã€æˆ–ã€ŒBç¾¤ã€";
            
            // ç°¡æ˜“åŠ‡æœ¬è§¸ç™¼åŠ åˆ†
            if(text.includes("é ­ç—›") && chatStep === 0) {
                reply = "ç‚ºäº†ç”¨è—¥å®‰å…¨ï¼Œè«‹å‘Šè¨´æˆ‘ï¼š1.å¹´é½¡ 2.é«”é‡ 3.éæ•å²";
                chatStep = 1;
            } else if (chatStep === 1) {
                reply = "æ”¶åˆ°ï¼å»ºè­°æ‚¨ä½¿ç”¨ä¹™é†¯èƒºé…šï¼Œä¸¦æ³¨æ„å‰¯ä½œç”¨ã€‚(æª¢å‚·å®Œæˆï¼Œç¶“é©—å€¼+50)";
                chatStep = 0;
                gainReward(50, 20); // èŠå¤©ç²å¾—çå‹µ
            } else if (text.includes("Bç¾¤")) {
                reply = "Bç¾¤æ˜¯ç”¨ä¾†æ²»ç™‚ç–²å‹çš„å–”ï¼(è¡›æ•™å®Œæˆï¼Œç¶“é©—å€¼+30)";
                gainReward(30, 10);
            }

            body.innerHTML += `<div class="msg msg-duck"><div class="bubble">${reply}</div></div>`;
            body.scrollTop = body.scrollHeight;
        }, 800);
    }
    
    // åˆå§‹åŒ– UI
    updateUI();

</script>

</body>
</html>
