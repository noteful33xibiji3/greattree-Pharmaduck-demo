<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pharma.Duck æ™ºæ…§è—¥å¸«åŠ©ç† (æ±ºè³½æ¼”ç¤ºç‰ˆ)</title>
    <style>
        /* === 1. å¤§æ¨¹è—¥å±€è¦–è¦ºé¢¨æ ¼ === */
        :root { --gt-green: #009944; --gt-orange: #F39800; --bg-gray: #f5f5f5; --gold: #FFD700; }
        body { font-family: "Microsoft JhengHei", "å¾®è»Ÿæ­£é»‘é«”", sans-serif; background-color: var(--bg-gray); margin: 0; padding-bottom: 50px; }
        
        /* Header */
        header { background: white; padding: 15px 0; border-bottom: 4px solid var(--gt-green); box-shadow: 0 2px 10px rgba(0,0,0,0.1); position: sticky; top: 0; z-index: 1000; }
        .nav-container { max-width: 1200px; margin: 0 auto; display: flex; align-items: center; justify-content: space-between; padding: 0 20px; }
        .logo img { height: 45px; } 
        
        /* å°èˆªæŒ‰éˆ• */
        .nav-btn { text-decoration: none; color: #555; font-weight: bold; padding: 8px 15px; border-radius: 20px; transition: 0.3s; display: flex; align-items: center; gap: 5px; }
        .nav-btn:hover { background: #e6f4ea; color: var(--gt-green); }
        .nav-btn.active { background: var(--gt-green); color: white; }
        .coin-box { background: #fffbe6; border: 1px solid var(--gold); color: #b7791f; padding: 5px 12px; border-radius: 15px; font-size: 14px; font-weight: bold; }

        /* å•†å“å€ */
        .main-content { max-width: 1200px; margin: 30px auto; padding: 0 20px; }
        .section-title { border-left: 5px solid var(--gt-orange); padding-left: 15px; font-size: 24px; color: #333; margin-bottom: 20px; font-weight: bold; display: flex; align-items: center; justify-content: space-between; }
        .product-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 20px; }
        
        /* å•†å“å¡ç‰‡ */
        .product-card { background: white; padding: 15px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); position: relative; transition: transform 0.2s; border: 2px solid transparent; overflow: hidden; }
        .product-card:hover { transform: translateY(-5px); border-color: var(--gt-green); }
        
        /* æ¨™ç±¤è¨­è¨ˆ */
        .tags-container { position: absolute; top: 10px; right: 10px; display: flex; flex-direction: column; gap: 5px; align-items: flex-end; z-index: 10; }
        .tag { color: white; padding: 3px 8px; font-size: 11px; border-radius: 4px; font-weight: bold; }
        .tag.drug { background: #d0021b; } /* è—¥å“ç´…æ¨™ */
        .tag.food { background: var(--gt-green); } /* é£Ÿå“ç¶ æ¨™ */
        .tag.target { background: #666; opacity: 0.9; } /* å°è±¡ç°æ¨™ */
        
        .p-img { width: 100%; height: 160px; object-fit: contain; margin-bottom: 15px; background: #fff; }
        .p-name { font-weight: bold; font-size: 15px; margin-bottom: 8px; line-height: 1.4; height: 42px; overflow: hidden; }
        .p-price { color: #d0021b; font-weight: bold; font-size: 18px; }

        /* === 2. é´¨å­åŠ©ç† (UIæ ¸å¿ƒ) === */
        /* ä¿®å¾©è·‘ç‰ˆï¼šè¨­å®šæœ€å¤§å¯¬åº¦èˆ‡æ­£ç¢ºå®šä½ */
        .duck-fab { 
            position: fixed; bottom: 20px; right: 20px; 
            width: 140px; height: 140px;
            cursor: pointer; z-index: 2000; 
            transition: transform 0.3s; 
        }
        .duck-fab:hover { transform: scale(1.05) translateY(-5px); }
        .duck-fab img { width: 100%; height: 100%; object-fit: contain; filter: drop-shadow(0 5px 10px rgba(0,0,0,0.3)); }
        
        /* èŠå¤©è¦–çª— */
        .chat-window {
            position: fixed; bottom: 20px; right: 180px; width: 380px; height: 600px;
            background: white; border-radius: 20px; box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            display: none; flex-direction: column; overflow: hidden; z-index: 2001; border: 1px solid #ddd;
            animation: slideIn 0.3s ease-out;
        }
        @keyframes slideIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        /* èŠå¤©è¦–çª— Header */
        .chat-header { background: var(--gt-green); color: white; padding: 15px; display: flex; flex-direction: column; gap: 5px; }
        .header-top { display: flex; align-items: center; justify-content: space-between; width: 100%; }
        .duck-avatar-small { width: 35px; height: 35px; border-radius: 50%; background: white; margin-right: 10px; border: 2px solid white; object-fit: cover; }
        
        /* ç­‰ç´šé€²åº¦æ¢ */
        .level-bar-bg { width: 100%; background: rgba(255,255,255,0.3); height: 6px; border-radius: 3px; margin-top: 5px; }
        .level-bar-fill { height: 100%; background: var(--gold); width: 0%; border-radius: 3px; transition: width 0.5s; }

        .chat-body { flex: 1; padding: 20px; overflow-y: auto; background: #f0fdf4; scroll-behavior: smooth; }
        
        /* å°è©±æ°£æ³¡ */
        .msg { margin-bottom: 20px; clear: both; }
        .msg-duck { float: left; width: 100%; }
        .msg-duck .bubble { background: white; padding: 15px; border-radius: 20px 20px 20px 5px; border: 1px solid #e5e7eb; box-shadow: 0 2px 5px rgba(0,0,0,0.05); max-width: 85%; float: left; }
        .msg-user { float: right; width: 100%; }
        .msg-user .bubble { background: var(--gt-green); color: white; padding: 12px 18px; border-radius: 20px 20px 5px 20px; max-width: 80%; float: right; }

        /* ç‰¹æ®Šå¡ç‰‡æ¨£å¼ */
        .card-insert { margin-top: 10px; border-radius: 12px; overflow: hidden; border: 1px solid #eee; background: white;}
        .card-insert img { width: 100%; display: block; }
        .warning-box { background: #fff5f5; border-left: 5px solid #fc8181; padding: 10px; margin-top: 10px; font-size: 13px; color: #c53030; line-height: 1.5; }
        
        .action-btn { display: block; width: 100%; padding: 12px; text-align: center; color: white; font-weight: bold; text-decoration: none; margin-top: 10px; border-radius: 8px; cursor: pointer; transition: 0.2s; box-sizing: border-box;}
        .btn-store { background: var(--gt-orange); } 
        .btn-online { background: var(--gt-green); } 

        /* è¼¸å…¥å€ */
        .chat-input { padding: 15px; border-top: 1px solid #eee; display: flex; background: white; gap: 10px; }
        .chat-input input { flex: 1; padding: 12px; border-radius: 25px; border: 2px solid #ddd; outline: none; font-size: 16px; }
        .chat-input button { background: var(--gt-orange); color: white; border: none; width: 50px; height: 50px; border-radius: 50%; cursor: pointer; font-size: 20px; display: flex; align-items: center; justify-content: center; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }

        /* å‡ç´šå½ˆçª— */
        .level-popup {
            position: absolute; top: 40%; left: 50%; transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.9); color: #FFD700; padding: 30px; border-radius: 20px; width: 220px;
            text-align: center; display: none; z-index: 3000; box-shadow: 0 10px 30px rgba(0,0,0,0.5); border: 2px solid #FFD700;
            animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        @keyframes popIn { from { transform: translate(-50%, -50%) scale(0.5); opacity: 0; } to { transform: translate(-50%, -50%) scale(1); opacity: 1; } }

        /* Footer */
        footer { background: #333; color: white; text-align: center; padding: 40px 0; margin-top: 50px; border-top: 5px solid var(--gt-orange); }
    </style>
</head>
<body>

<header>
    <div class="nav-container">
        <div class="logo">
            <img src="images/logo.png" alt="å¤§æ¨¹è—¥å±€ Logo" onerror="this.parentNode.innerText='ğŸŒ³ å¤§æ¨¹å¥åº·è³¼ç‰©ç¶² (Demo)';">
        </div>
        
        <div style="display: flex; gap: 10px; align-items: center;">
            <a href="index.html" class="nav-btn active">ğŸ  è³¼ç‰©é¦–é </a>
            <a href="member.html" class="nav-btn">
                <span>ğŸ¦† é¤Šæˆä¸­å¿ƒ</span>
                <span class="coin-box">ğŸ’° <span id="navCoin">0</span></span>
            </a>
        </div>
    </div>
</header>

<div class="main-content">
    <div class="section-title">
        <span>ğŸ’Š è—¥å¸«åš´é¸ï¼šå…¨é½¡å¥åº·å°ˆå€</span>
        <span style="font-size:14px; color:#666; font-weight:normal;">å«è—¥å“/ä¿å¥å“åˆ†é¡</span>
    </div>
    <div class="product-grid" id="productGrid">
        </div>
</div>

<div class="duck-fab" onclick="toggleChat()">
    <img id="mainDuckImg" src="images/my_duck.png" alt="Ph.D é´¨é´¨" onerror="this.src='https://placehold.co/200x200/F39800/white?text=Duck'">
    <div style="position: absolute; bottom: -10px; left: 50%; transform: translateX(-50%); background: #333; color: #fff; padding: 2px 10px; border-radius: 10px; font-size: 12px; white-space: nowrap; box-shadow: 0 2px 5px rgba(0,0,0,0.3);">
        é»æˆ‘è«®è©¢
    </div>
</div>

<div class="chat-window" id="chatWindow">
    <div class="chat-header">
        <div class="header-top">
            <div style="display:flex; align-items:center;">
                <img id="chatDuckImg" src="images/my_duck.png" class="duck-avatar-small">
                <span id="chatTitle">Ph.D é´¨å­è—¥å¸«</span>
            </div>
            <div style="background:#F39800; padding:2px 8px; border-radius:10px; font-size:12px;" id="lvBadge">Lv.1</div>
            <div style="cursor: pointer; font-size: 20px;" onclick="toggleChat()">Ã—</div>
        </div>
        <div style="font-size: 11px; display:flex; justify-content:space-between; margin-top:5px;">
            <span>è·é›¢å‡ç´š</span>
            <span id="expText">0/100</span>
        </div>
        <div class="level-bar-bg">
            <div class="level-bar-fill" id="expBar"></div>
        </div>
    </div>
    
    <div class="chat-body" id="chatBody">
        <div class="msg msg-duck">
            <div class="bubble">
                å‘±ï¼æˆ‘æ˜¯æ‚¨çš„å¤§æ¨¹å¥åº·é¡§å• Ph.D é´¨é´¨ã€‚ğŸ¦†<br><br>
                <b>ã€æ¼”ç¤ºæŒ‡ä»¤ã€‘</b><br>
                1. è¼¸å…¥ã€Œ<b>é ­ç—›</b>ã€é«”é©—æª¢å‚·èˆ‡å…’ç«¥è­¦ç¤ºã€‚<br>
                2. è¼¸å…¥ã€Œ<b>Bç¾¤</b>ã€çœ‹è¡›æ•™æ¢—åœ–ã€‚<br>
                3. å®Œæˆäº’å‹•å¯å‡ç´šæ›è£å–”ï¼
            </div>
        </div>
    </div>

    <div class="chat-input">
        <input type="text" id="userInput" placeholder="è«‹è¼¸å…¥ç—‡ç‹€æˆ–å•†å“å..." onkeypress="handleKeyPress(event)">
        <button onclick="sendMessage()">â¤</button>
    </div>
</div>

<div class="level-popup" id="levelUpModal">
    <div style="font-size: 50px;">ğŸ‰</div>
    <h2 style="margin: 10px 0;">æ­å–œå‡ç´šï¼</h2>
    <p style="color:white; margin-bottom:5px;" id="newLvName">Lv.2 å¥½å¥‡å­¸å¾’</p>
    <p style="font-size: 14px; color: #FFD700;">é´¨é´¨å·²æ›ä¸Šæ–°æ™‚è£ï¼</p>
</div>

<footer>
    <div style="font-size: 20px; font-weight: bold; color: var(--gt-orange); margin-bottom: 10px;">åœ˜éšŠï¼šä¸€é´¨treeåƒ ğŸ¦†</div>
    <div style="font-size: 16px;">å˜‰å—è—¥ç†å¤§å­¸ è—¥å­¸ç³» | ç¬¬ä¸‰å±†å¤§æ¨¹è—¥å±€å‰µæ„ç«¶è³½</div>
    <div style="font-size: 12px; color: #888; margin-top: 15px; line-height: 1.6;">
        æœ¬ç¶²é  IP å½¢è±¡èˆ‡å…§å®¹åƒ…ä¾›ç«¶è³½å±•ç¤ºä½¿ç”¨ï¼ŒéçœŸå¯¦ç‡Ÿé‹ç¶²ç«™ã€‚<br>
        æœ¬ç³»çµ±æä¾›ä¹‹å»ºè­°åƒ…ä¾›åƒè€ƒï¼Œè‹¥æœ‰èº«é«”ä¸é©è«‹å‹™å¿…è«®è©¢å°ˆæ¥­é†«å¸«æˆ–è—¥å¸«ã€‚<br>
        Copyright Â© 2026 Pharma.Duck. All rights reserved.
    </div>
</footer>

<script>
    // === 1. 10ç¨®ç²¾é¸å•†å“ (åˆ†è—¥å“/é£Ÿå“, å¤§äºº/å°å­©/è€äºº) ===
    const products = [
        // è—¥å“ (Drug - é–€å¸‚é™å®š)
        { id: 1, name: "æ™®æ‹¿ç–¼ æ­¢ç—›éŒ  (ä¹™é†¯èƒºé…š)", price: 150, type: "drug", target: "å¤§äºº", form: "éŒ åŠ‘", image: "images/p_panadol.jpg" },
        { id: 2, name: "å®‰ä½³ç†± é€€ç‡’ç³–æ¼¿ (å…’ç«¥å°ˆç”¨)", price: 120, type: "drug", target: "å°å­©", form: "è—¥æ°´", image: "images/p_kids_syrup.jpg" },
        { id: 3, name: "åˆåˆ©ä»–å‘½ Ex Plus (Bç¾¤)", price: 1800, type: "drug", target: "å¤§äºº", form: "éŒ åŠ‘", image: "images/p_explus.jpg" },
        { id: 4, name: "è‹¥å…ƒéŒ  Wakamoto (è…¸èƒƒ)", price: 600, type: "drug", target: "å…¨é½¡", form: "éŒ åŠ‘", image: "images/p_waka.jpg" },
        
        // ä¿å¥å“ (Food - ç·šä¸Šå¯è³¼)
        { id: 5, name: "å¤§æ¨¹ Bç¾¤+éµ (å¢å¼·é«”åŠ›)", price: 600, type: "food", target: "å¤§äºº", form: "éŒ åŠ‘", image: "images/p_b_complex.jpg" },
        { id: 6, name: "èŠèƒç¾ ç¶­ä»–å‘½C (é«˜å–®ä½)", price: 550, type: "food", target: "å¤§äºº", form: "éŒ åŠ‘", image: "images/p_vit_c.jpg" },
        { id: 7, name: "å°å…’åˆ©æ’’çˆ¾ ç¶­ä»–å‘½C (è»Ÿç³–)", price: 399, type: "food", target: "å°å­©", form: "è»Ÿç³–", image: "images/p_kids_c.jpg" },
        { id: 8, name: "ç™¼æ³¡éŒ  ç¶­ä»–å‘½C (å¥½å¸æ”¶)", price: 280, type: "food", target: "å…¨é½¡", form: "æ¶²é«”", image: "images/p_effervescent.jpg" },
        { id: 9, name: "å¤§æ¨¹ è‘¡è„ç³–èƒºé£² (æ¶²æ…‹)", price: 680, type: "food", target: "è€äºº", form: "æ¶²é«”", image: "images/p_gluco.jpg" },
        { id: 10, name: "å–„å­˜ éŠ€å¯¶ç¶œåˆç¶­ä»–å‘½", price: 880, type: "food", target: "è€äºº", form: "éŒ åŠ‘", image: "images/p_senior_vit.jpg" }
    ];

    // åˆå§‹åŒ–å•†å“åˆ—è¡¨
    const grid = document.getElementById('productGrid');
    products.forEach(p => {
        // å‚™ç”¨åœ–ç‰‡ (é˜²æ­¢ç ´åœ–)
        const fallback = `https://placehold.co/300x200/${p.type==='drug'?'ffebee':'e8f5e9'}/333?text=${encodeURIComponent(p.name)}`;
        
        grid.innerHTML += `
            <div class="product-card">
                <div class="tags-container">
                    <span class="tag ${p.type}">${p.type==='drug'?'é–€å¸‚é™å®šè—¥å“':'ç·šä¸Šä¿å¥é£Ÿå“'}</span>
                    <span class="tag target">${p.target}ç”¨</span>
                    <span class="tag target">${p.form}</span>
                </div>
                <img class="p-img" src="${p.image}" onerror="this.src='${fallback}'">
                <div class="p-name">${p.name}</div>
                <div class="p-price">$${p.price}</div>
            </div>`;
    });

    // === 2. 10ç´šç­‰ç´šè¨­å®šèˆ‡æ™‚è£ (Gamification) ===
    const levelConfig = [
        { lv: 1, name: "åˆç”Ÿå°é´¨", img: "images/duck_lv1.png", max: 100 },
        { lv: 2, name: "å¥½å¥‡å­¸å¾’", img: "images/duck_lv2.png", max: 200 },
        { lv: 3, name: "å¤§æ¨¹æ¢å“¡", img: "images/duck_lv3.png", max: 300 },
        { lv: 4, name: "å¥åº·å¤¥ä¼´", img: "images/duck_lv4.png", max: 400 },
        { lv: 5, name: "å°èˆªåš®å°", img: "images/duck_lv5.png", max: 500 },
        { lv: 6, name: "çŸ¥è­˜è¡›å£«", img: "images/duck_lv6.png", max: 600 },
        { lv: 7, name: "å¤§æ¨¹å†’éšªå®¶", img: "images/duck_lv7.png", max: 700 },
        { lv: 8, name: "è—¥å±€å¤§ä½¿", img: "images/duck_lv8.png", max: 800 },
        { lv: 9, name: "å®ˆè­·é•·è€", img: "images/duck_lv9.png", max: 900 },
        { lv: 10, name: "å¤§æ¨¹å®ˆè­·ç¥", img: "images/duck_lv10.png", max: 9999 }
    ];

    // è®€å– localStorage (è·Ÿ member.html å…±ç”¨)
    let userState = JSON.parse(localStorage.getItem('duckUser')) || { level: 1, exp: 0, coins: 0 };

    function updateDuckLook() {
        // æ‰¾å‡ºç›®å‰ç­‰ç´šçš„è¨­å®š
        let config = levelConfig.find(l => l.lv === userState.level) || levelConfig[0];
        
        // æ›´æ–°åœ–ç‰‡ (å¦‚æœæ‰¾ä¸åˆ°æª”æ¡ˆï¼Œæœƒé€€å›é è¨­ duck.png)
        const duckImgs = document.querySelectorAll('#mainDuckImg, #chatDuckImg');
        duckImgs.forEach(img => {
            // é€™è£¡ä½¿ç”¨ images/duck_lvX.pngï¼Œè«‹ç¢ºä¿ä½ æœ‰é€™äº›åœ–ï¼Œæˆ–è‡³å°‘æœ‰ duck.png
            img.src = config.img; 
            img.onerror = function() { this.src = "images/my_duck.png"; };
        });

        // æ›´æ–°æ–‡å­— UI
        document.getElementById('navCoin').innerText = userState.coins;
        document.getElementById('lvBadge').innerText = `Lv.${userState.level}`;
        document.getElementById('chatTitle').innerText = config.name;
        
        // æ›´æ–°ç¶“é©—æ¢
        let percent = Math.min(100, (userState.exp / config.max) * 100);
        document.getElementById('expBar').style.width = `${percent}%`;
        document.getElementById('expText').innerText = `${userState.exp}/${config.max}`;
        
        // å­˜å› storage
        localStorage.setItem('duckUser', JSON.stringify(userState));
    }

    function addRewards(exp, coins) {
        userState.exp += exp;
        userState.coins += coins;
        
        // æª¢æŸ¥å‡ç´š
        let config = levelConfig.find(l => l.lv === userState.level);
        if (userState.exp >= config.max && userState.level < 10) {
            userState.exp -= config.max;
            userState.level++;
            
            // å‡ç´šå½ˆçª—
            let newName = levelConfig.find(l => l.lv === userState.level).name;
            document.getElementById('newLvName').innerText = `Lv.${userState.level} ${newName}`;
            const modal = document.getElementById('levelUpModal');
            modal.style.display = 'block';
            setTimeout(() => modal.style.display = 'none', 3000);
        }
        updateDuckLook();
    }

    // åˆå§‹åŒ–
    updateDuckLook();


    // === 3. èŠå¤©é‚è¼¯ (åŠ‡æœ¬ A: æª¢å‚· / åŠ‡æœ¬ B: è¡›æ•™) ===
    let chatStep = 0;
    
    function toggleChat() {
        const win = document.getElementById('chatWindow');
        win.style.display = win.style.display === 'flex' ? 'none' : 'flex';
        if(win.style.display === 'flex') document.getElementById('userInput').focus();
    }
    
    function handleKeyPress(e) { if(e.key === 'Enter') sendMessage(); }

    function sendMessage() {
        const input = document.getElementById('userInput');
        const text = input.value.trim();
        if(!text) return;

        addMsg(text, 'user');
        input.value = '';

        setTimeout(() => { duckResponse(text); }, 800);
    }

    function duckResponse(text) {
        // --- åŠ‡æœ¬ Aï¼šé ­ç—›æª¢å‚· (é‡å°å°æœ‹å‹åŠ‘å‹èˆ‡å‰¯ä½œç”¨) ---
        if (chatStep === 0 && (text.includes("é ­ç—›") || text.includes("ç—›"))) {
            addMsg("æ”¶åˆ°ã€‚ç‚ºäº†ç”¨è—¥å®‰å…¨ï¼Œè«‹å‘Šè¨´æˆ‘ä½¿ç”¨è€…çš„ï¼š<br>1. <b>å¹´é½¡</b><br>2. <b>é«”é‡</b> (å°æœ‹å‹éœ€è¨ˆç®—åŠ‘é‡)", 'duck');
            chatStep = 1; 
        }
        else if (chatStep === 1) {
            // åˆ¤æ–·æ˜¯å¦ç‚ºå…’ç«¥ (æ¨¡æ“¬è¼¸å…¥ "5æ­²" æˆ– "20kg")
            if (text.includes("æ­²") && parseInt(text) < 12) {
                addMsg("âš ï¸ <b>å…’ç«¥è­¦ç¤ºï¼šå°æœ‹å‹ååš¥èƒ½åŠ›æœªå…¨ï¼Œä¸å»ºè­°ä½¿ç”¨éŒ åŠ‘ï¼</b><br>å»ºè­°æ”¹ç”¨<b>è—¥æ°´</b>æˆ–<b>ç²‰åŠ‘</b>ã€‚<br><br>æ¥è‘—è«‹ç¢ºèªï¼š<b>æœ‰ç„¡éæ•å²ï¼Ÿ</b>", 'duck');
            } else {
                addMsg("äº†è§£ã€‚æ¥è‘—è«‹ç¢ºèªï¼š<b>æœ‰ç„¡è—¥ç‰©æˆ–é£Ÿç‰©éæ•å²ï¼Ÿ</b>", 'duck');
            }
            chatStep = 2; 
        }
        else if (chatStep === 2) {
            chatStep = 0; 
            addRewards(50, 20); // çå‹µ

            // æ¨è–¦è—¥å“ (Drug)
            addMsg("å¦‚æœæ˜¯ç™¼ç‡’é ­ç—›ï¼Œè—¥å¸«å»ºè­°ä½¿ç”¨ <b>ä¹™é†¯èƒºé…š</b> æˆåˆ†è—¥å“ (å¦‚å®‰ä½³ç†±/æ™®æ‹¿ç–¼)ã€‚", 'duck');
            
            setTimeout(() => {
                const warningHTML = `
                    <div class="warning-box">
                        <b>ğŸ’Š ç”¨è—¥è­¦ç¤ºï¼š</b><br>
                        æ­¤è—¥å“å¯èƒ½å‚·èƒƒï¼Œè«‹é£¯å¾Œæœç”¨ã€‚æœè—¥æœŸé–“<b>ç¦æ­¢é£²é…’</b>ã€‚è‹¥å‡ºç¾ç´…ç–¹è«‹ç«‹å³åœè—¥ã€‚
                    </div>
                    <div class="action-btn btn-store" onclick="showMap()">
                        ğŸ“ æŸ¥è©¢æœ€è¿‘é–€å¸‚ (ç¢ºèªåº«å­˜)
                    </div>
                `;
                addMsg(warningHTML, 'duck');
            }, 500);

            // æ¨è–¦ç·šä¸Šä¿å¥å“ (Food)
            setTimeout(() => {
                addMsg("å¦å¤–ï¼Œè‹¥æ˜¯å°å­©ç¶“å¸¸æ„Ÿå†’ï¼Œå»ºè­°è£œå……<b>ç¶­ä»–å‘½C</b>å¢å¼·ä¿è­·åŠ›ï¼š", 'duck');
                const recHTML = `
                    <div class="card-insert">
                        <img src="images/p_kids_c.jpg" onerror="this.src='https://placehold.co/300x150/e8f5e9/333?text=Kids+Vit+C'">
                        <div style="padding:10px;">
                            <b>å°å…’åˆ©æ’’çˆ¾ ç¶­ä»–å‘½C (è»Ÿç³–)</b>
                            <div class="action-btn btn-online" onclick="window.open('https://shop.greattree.com.tw')">
                                ğŸ›’ ç·šä¸Šè³¼è²· (æ»¿é¡å…é‹)
                            </div>
                        </div>
                    </div>
                `;
                addMsg(recHTML, 'duck');
            }, 2000);
        }

        // --- åŠ‡æœ¬ Bï¼šBç¾¤è¡›æ•™æ¢—åœ– ---
        else if (text.includes("Bç¾¤") || text.includes("ç¶­ä»–å‘½")) {
            addMsg("å¾ˆå¤šäººææ·· <b>Bç¾¤</b> è·Ÿ <b>ç¶œåˆç¶­ä»–å‘½</b>ï¼ğŸ¦†<br>çœ‹é€™å¼µåœ–ä½ å°±æ‡‚äº†ï¼š", 'duck');
            setTimeout(() => {
                const memeHTML = `
                    <div class="card-insert">
                        <img src="images/meme_b_vit.jpg" onerror="this.src='https://placehold.co/300x200/eee/555?text=Meme:+B-Complex+vs+Multi'">
                    </div>
                    <div style="font-size:13px; color:#666; margin-top:5px;">
                        ğŸ”¥ <b>Bç¾¤</b>ï¼šé«˜åŠ‘é‡ï¼Œæ²»ç™‚ç–²å‹ç¥ç¶“ç—›ã€‚<br>
                        ğŸ¥— <b>ç¶œåˆç¶­ä»–å‘½</b>ï¼šåŸºç¤ä¿é¤Šï¼Œè£œè¶³é£²é£Ÿç¼ºå£ã€‚
                    </div>
                `;
                addMsg(memeHTML, 'duck');
                addRewards(30, 10); // çå‹µ
            }, 600);
        }

        // --- é è¨­ ---
        else {
            addMsg("é´¨é´¨æ­£åœ¨å­¸ç¿’ä¸­... è«‹è¼¸å…¥ã€Œ<b>é ­ç—›</b>ã€æˆ–ã€Œ<b>Bç¾¤</b>ã€ä¾†æ¸¬è©¦åŠŸèƒ½ï¼", 'duck');
            chatStep = 0;
        }
    }

    function addMsg(content, sender) {
        const body = document.getElementById('chatBody');
        body.innerHTML += `<div class="msg msg-${sender}"><div class="bubble">${content}</div></div>`;
        body.scrollTop = body.scrollHeight;
    }

    function showMap() {
        addMsg("æ­£åœ¨ç‚ºæ‚¨å®šä½... ğŸ“", 'duck');
        setTimeout(() => {
            const mapHTML = `
                <div class="card-insert">
                    <img src="images/map_demo.jpg" onerror="this.src='https://placehold.co/300x200/a5d6a7/333?text=Map:+GreatTree+Pharmacy'">
                    <div style="padding:10px; font-size:14px;">
                        <b>è·é›¢æœ€è¿‘ï¼šå¤§æ¨¹è—¥å±€ ä»å¾·åº—</b><br>
                        <span style="color:#666;">è·é›¢ 500 å…¬å°º | ç‡Ÿæ¥­ä¸­</span>
                    </div>
                </div>
            `;
            addMsg(mapHTML, 'duck');
            addRewards(20, 5);
        }, 800);
    }
</script>

</body>
</html>
